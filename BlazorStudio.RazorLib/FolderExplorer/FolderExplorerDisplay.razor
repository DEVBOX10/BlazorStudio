@using BlazorStudio.ClassLib.Context
@using BlazorStudio.ClassLib.Store.FolderExplorerCase
@using BlazorStudio.RazorLib.ContextCase
@using BlazorStudio.ClassLib.Store.SolutionExplorer
@using BlazorALaCarte.Shared.Dropdown
@using BlazorALaCarte.TreeView
@using BlazorALaCarte.TreeView.Displays
@using BlazorStudio.RazorLib.FolderExplorer.InternalComponents
@using Microsoft.AspNetCore.Components.Authorization

<ContextBoundary ContextRecord="ContextFacts.FolderExplorerContext"
                 ClassCssString="bstudio_folder-explorer-display"
                 StyleCssString="height: 100%">
    
    <div class="bstudio_section-title">
        Folder Explorer
        
        (GroupName:&nbsp;
        <em class="balc_em">@AccountStateWrap.Value.GroupName</em>
        )
    </div>
    
    <div class="bstudio_section-body">
        
        <AuthorizeView>
            <Authorized>
                @{
                    var folderExplorerState = FolderExplorerStateWrap.Value;
        
                    if (folderExplorerState.AbsoluteFilePath is null)
                    {
                        <ButtonDisplay OnClickFunc="async () => await FolderExplorerState.ShowInputFileAsync(Dispatcher)">
                            Open Folder
                        </ButtonDisplay>
                    }
                    else
                    {
                        <CascadingValue Name="BlazorTreeViewIconWidth" Value="AppOptionsStateWrap.Value.Options.IconSizeInPixels">
                            <CascadingValue Name="BlazorTreeViewIconHeight" Value="AppOptionsStateWrap.Value.Options.IconSizeInPixels">
                                <CascadingValue Name="OffsetPerDepthInPixels" Value="OffsetPerDepthInPixels">
                                    <TreeViewStateDisplay TreeViewStateKey="TreeViewFolderExplorerContentStateKey"
                                                          CssStyleString="height: 100%;"
                                                          OnContextMenuFunc="OnTreeViewContextMenuFunc"
                                                          TreeViewKeyboardEventHandler="_folderExplorerTreeViewKeyboardEventHandler"
                                                          TreeViewMouseEventHandler="_folderExplorerTreeViewMouseEventHandler"/>
                                </CascadingValue>
                            </CascadingValue>
                        </CascadingValue>
        
        
                        <DropdownDisplay DropdownKey="FolderExplorerContextMenu.ContextMenuEventDropdownKey"
                                         DropdownPositionKind="DropdownPositionKind.Unset"
                                         CssStyleString="@FolderExplorerContextMenu.GetContextMenuCssStyleString(_mostRecentTreeViewCommandParameter)">
        
                            <FolderExplorerContextMenu TreeViewCommandParameter="_mostRecentTreeViewCommandParameter"/>
                        </DropdownDisplay>
                    }
                }
            </Authorized>
            <NotAuthorized>
                <a href="authentication/login">Log in</a>
            </NotAuthorized>
        </AuthorizeView>
    </div>
</ContextBoundary>