@inherits Fluxor.Blazor.Web.Components.FluxorComponent

@using BlazorStudio.ClassLib.FileSystem.Interfaces
@using BlazorStudio.ClassLib.FileConstants

<div class="bstudio_solution-explorer"
     style="@Dimensions.DimensionsCssString">

    <h5 class="bstudio_h5-title" style="height: 2rem;">
        Solution Explorer&nbsp;
    </h5>

    @{
        var solutionExplorerState = SolutionExplorerStateWrap.Value;

        if (_loadingSln)
        {
                        <div>Loading @SolutionExplorerStateWrap.Value.SolutionAbsoluteFilePath?.FilenameWithExtension</div>
        }
        else if (solutionExplorerState.SolutionAbsoluteFilePath is null)
        {
                            <div>
                                SolutionAbsoluteFilePath is null, use the InputFile dialog to select a SolutionAbsoluteFilePath
                                directory.
                            </div>
                            <div>
                                <BlazorStudio.RazorLib.InputFile.InputFileDialogEntryPoint />
                            </div>
        }
        else
        {
            if (_isInitialized)
            {
                if (_solutionExplorerStateWrapStateChangedRichErrorModel is not null)
                {
                                    <RichErrorDisplay RichErrorModel="_solutionExplorerStateWrapStateChangedRichErrorModel" />
                }
                else
                {
                                <div class="bstudio_solution-explorer"
                                     style="width: 100%;">                        
                                    
                                    <DropdownDisplay Dimensions="_fileDropdownDimensions"
                                         DropdownKey="_fileDropdownKey">
                                     
                                        @{
                                var contextMenuEventDto = new TreeViewWrapDisplay<IAbsoluteFilePath>.ContextMenuEventDto<IAbsoluteFilePath>
                                {
                                    Item = solutionExplorerState.SolutionAbsoluteFilePath,
                                    MouseEventArgs = null,
                                    RefreshContextMenuTarget = async () => SolutionExplorerStateWrap_StateChanged(null, EventArgs.Empty)
                                }; 
                
                                                        <em>@contextMenuEventDto.Item.FilenameWithExtension</em>

                                                        <MenuDisplay MenuOptionRecords="GetMenuOptionRecords(contextMenuEventDto)" />
                                        }

                                    </DropdownDisplay>

                                    <TreeViewWrapDisplay @ref="_treeViewWrapDisplay"
                             ShouldDispose="false"
                             TreeViewWrapKey="_inputFileTreeViewKey"
                             T="IAbsoluteFilePath"
                             RootItems="_rootAbsoluteFilePaths"
                             GetChildrenFunc="LoadAbsoluteFilePathChildrenAsync"
                             Context="absoluteFilePath"
                             OnEnterKeyDown="WorkspaceExplorerTreeViewOnEnterKeyDown"
                             OnSpaceKeyDown="WorkspaceExplorerTreeViewOnSpaceKeyDown"
                             OnDoubleClick="WorkspaceExplorerTreeViewOnDoubleClick"
                             IsExpandable="GetIsExpandable"
                             StyleString="height: 100%;"
                             BodyCssClassAttribute="bstudio_workspace-explorer-tree-view-body">

                                            <ItemRenderFragment>
                                                <SolutionExplorerIconDisplay AbsoluteFilePath="absoluteFilePath" />

                                                <span title="@absoluteFilePath.GetAbsoluteFilePathString()">
                                                    @absoluteFilePath.FilenameWithExtension
                                                </span>
                                            </ItemRenderFragment>

                                            <OnContextMenuRenderFragment Context="contextMenuEventDto">

                                                <em>@contextMenuEventDto.Item.FilenameWithExtension</em>

                                                <MenuDisplay MenuOptionRecords="GetMenuOptionRecords(contextMenuEventDto)" />

                                            </OnContextMenuRenderFragment>

                                            <HeaderRenderFragment Context="activeItems">
                                                <div class="bstudio_solution-explorer-tree-view-header">
                                                    <div style="display: inline-flex; align-items: center;">
                                                        <span title="icon"
                                                              style="display: inline-flex; align-items: center; margin-right: 4px;">
                                                            @if (solutionExplorerState.SolutionAbsoluteFilePath.ExtensionNoPeriod == ExtensionNoPeriodFacts.DOT_NET_SOLUTION)
                                                            {
                                                                <IconSolution />
                                                            }
                                                            else
                                                            {
                                                                <IconDiff />
                                                            }
                                                        </span>
                                                        <span title="@solutionExplorerState.SolutionAbsoluteFilePath.GetAbsoluteFilePathString()"
                                                              style="display: inline-flex; align-items: center;">
                                                            
                                                            @solutionExplorerState.SolutionAbsoluteFilePath.FilenameWithExtension
                                                        </span>
                                                    </div>
                                                </div>
                                            </HeaderRenderFragment>
                                        </TreeViewWrapDisplay>
                                    </div>
                }
            }
        }
    }
</div>
