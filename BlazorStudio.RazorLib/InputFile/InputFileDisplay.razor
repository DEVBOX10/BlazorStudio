@using BlazorALaCarte.Shared.Resize
@inherits Fluxor.Blazor.Web.Components.FluxorComponent

<div class="bstudio_input-file-display">
    @if (HeaderRenderFragment is not null)
    {
        @HeaderRenderFragment(_selectedAbsoluteFilePath)
    }
    
    @{
        _searchMatchTuples = new();
    }
    
    <CascadingValue Name="SetInputFileContentTreeViewRoot" Value="SetInputFileContentTreeViewRoot">
        <CascadingValue Value="_treeViewMouseEventRegistrar">
            <CascadingValue Value="_inputFileTreeViewKeymap">
                <CascadingValue Name="SearchMatchTuples" Value="_searchMatchTuples">
                    <InputFileTopNavBar @ref="_inputFileTopNavBarComponent"/>
                    
                    <div class="bstudio_input-file-display-body @BodyClassCssString"
                         style="@BodyStyleCssString">

                        <InputFileSidebar ElementDimensions="_navMenuElementDimensions"
                                          SetSelectedAbsoluteFilePath="tvm => _selectedAbsoluteFilePath = tvm"/>

                        <ResizableColumn LeftElementDimensions="_navMenuElementDimensions"
                                         RightElementDimensions="_contentElementDimensions"
                                         ReRenderFuncAsync="() => InvokeAsync(StateHasChanged)"/>

                        <InputFileContent ElementDimensions="_contentElementDimensions"
                                          SetSelectedAbsoluteFilePath="tvm => _selectedAbsoluteFilePath = tvm" />
                    </div>
                    
                    <InputFileBottomControls />
                </CascadingValue>
            </CascadingValue>
        </CascadingValue>
    </CascadingValue>

    @if (FooterRenderFragment is not null)
    {
        @FooterRenderFragment(_selectedAbsoluteFilePath)
    }
</div>